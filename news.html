<!doctype html>
<html lang="ta">
<head>
  <meta charset="utf-8" />
  <title>Tamil News Feed</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 20px; }
    .article { border: 1px solid #ddd; border-radius: 8px; padding: 16px; margin-bottom: 16px; }
    .meta { color: #666; font-size: 0.9em; margin-bottom: 8px; }
    .toggle { margin: 8px 0; }
    .title { font-weight: 700; font-size: 1.1em; margin: 6px 0; }
    .content { white-space: pre-wrap; line-height: 1.6; }
    .pill { display: inline-block; padding: 2px 8px; border-radius: 999px; background: #eef; color: #334; font-size: 12px; margin-left: 8px; }
  </style>
</head>
<body>
  <h1>தமிழ் செய்தி (AI-Enhanced)</h1>
  <div id="root">Loading…</div>

  <script>
    const API_URL = "http://127.0.0.1:5000/api/articles";

    async function loadArticles() {
      const root = document.getElementById('root');
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        const articles = data.articles || [];

        if (!articles.length) {
          root.textContent = "No articles found.";
          return;
        }

        root.innerHTML = "";
        articles.forEach((a, idx) => {
          // Choose title/content based on toggle later
          const container = document.createElement('div');
          container.className = 'article';

          // Meta
          const meta = document.createElement('div');
          meta.className = 'meta';
          meta.textContent = `${a.source || 'Unknown source'} • ${a.published || ''}`;
          container.appendChild(meta);

          // Title
          const titleEl = document.createElement('div');
          titleEl.className = 'title';
          titleEl.textContent = a.enhanced_title || a.translated_title || a.title || "—";
          if (a.is_enhanced) {
            const pill = document.createElement('span');
            pill.className = 'pill';
            pill.textContent = 'AI-enhanced';
            titleEl.appendChild(pill);
          }
          container.appendChild(titleEl);

          // Toggle
          const toggle = document.createElement('div');
          toggle.className = 'toggle';
          toggle.innerHTML = `
            <label>
              <input type="radio" name="view-${idx}" value="enhanced" ${a.enhanced_content ? 'checked' : ''} />
              AI Enhanced
            </label>
            <label style="margin-left: 12px;">
              <input type="radio" name="view-${idx}" value="translated" ${!a.enhanced_content ? 'checked' : ''} />
              Translated
            </label>
            <label style="margin-left: 12px;">
              <input type="radio" name="view-${idx}" value="original" />
              Original
            </label>
          `;
          container.appendChild(toggle);

          // Content
          const contentEl = document.createElement('div');
          contentEl.className = 'content';
          const pickContent = (mode) => {
            if (mode === 'enhanced') return a.enhanced_content || 'No enhanced content.';
            if (mode === 'translated') return a.translated_content || 'No translated content.';
            return a.full_content || a.description || 'No original content.';
          };
          contentEl.textContent = pickContent(a.enhanced_content ? 'enhanced' : 'translated');
          container.appendChild(contentEl);

          // Change handler
          toggle.addEventListener('change', (e) => {
            const mode = e.target.value;
            titleEl.firstChild.textContent = (mode === 'enhanced'
              ? (a.enhanced_title || a.translated_title || a.title)
              : mode === 'translated'
                ? (a.translated_title || a.title)
                : (a.title)) || "—";
            contentEl.textContent = pickContent(mode);
          });

          // Link back to source
          const link = document.createElement('div');
          link.style.marginTop = '8px';
          const aTag = document.createElement('a');
          aTag.href = a.original_url || a.link;
          aTag.target = "_blank";
          aTag.rel = "noopener noreferrer";
          aTag.textContent = "Read original article";
          link.appendChild(aTag);
          container.appendChild(link);

          root.appendChild(container);
        });

      } catch (err) {
        root.textContent = "Failed to load articles: " + err.message;
      }
    }

    loadArticles();
  </script>
</body>
</html>

